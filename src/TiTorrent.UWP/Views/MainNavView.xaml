<Page
    x:Class="TiTorrent.UWP.Views.MainNavView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mtConverters="using:Microsoft.Toolkit.Uwp.UI.Converters"
    xmlns:myConverters="using:TiTorrent.Shared.Converters"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    DataContext="{Binding MainVm, Source={StaticResource VmLocator}}"
    mc:Ignorable="d">

    <Page.Resources>
        <myConverters:FullPathToFileNameConverter x:Name="FullPathToFileNameConverter" />
        <mtConverters:StringFormatConverter x:Name="StringFormatConverter" />

        <MenuFlyout x:Key="ListViewItemFlyout">
            <MenuFlyout.Items>
                <MenuFlyoutItem
                    x:Uid="MainNavView_ListViewItemFlyout_MenuFlyoutItem0"
                    Command="{x:Bind _viewModel.BStartCommand}"
                    Icon="Play" />
                <MenuFlyoutItem
                    x:Uid="MainNavView_ListViewItemFlyout_MenuFlyoutItem1"
                    Command="{x:Bind _viewModel.BPauseCommand}"
                    Icon="Pause" />
                <MenuFlyoutItem
                    x:Uid="MainNavView_ListViewItemFlyout_MenuFlyoutItem2"
                    Command="{x:Bind _viewModel.BStopCommand}"
                    Icon="Stop" />

                <MenuFlyoutSeparator />

                <MenuFlyoutItem
                    x:Uid="MainNavView_ListViewItemFlyout_MenuFlyoutItem4"
                    Command="{x:Bind _viewModel.BDeleteCommand}"
                    Icon="Delete" />

                <MenuFlyoutSeparator />

                <MenuFlyoutItem
                    x:Uid="MainNavView_ListViewItemFlyout_MenuFlyoutItem6"
                    Command="{x:Bind _viewModel.FOpenFolderCommand}"
                    Icon="Folder" />
            </MenuFlyout.Items>
        </MenuFlyout>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <CommandBar
            Grid.Row="0"
            Margin="5"
            Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
            DefaultLabelPosition="Right"
            OverflowButtonVisibility="Collapsed">

            <AppBarButton
                x:Uid="MainNavView_CommandBar_AppBarButton_Add"
                Command="{Binding BAddCommand}"
                Icon="Add"
                Style="{ThemeResource AppBarButtonRevealStyle}" />

            <AppBarButton
                x:Uid="MainNavView_CommandBar_AppBarButton_Delete"
                Command="{Binding BDeleteCommand}"
                Icon="Delete"
                Style="{ThemeResource AppBarButtonRevealStyle}" />

            <AppBarSeparator />

            <AppBarButton
                x:Uid="MainNavView_CommandBar_AppBarButton_Start"
                Command="{Binding BStartCommand}"
                Icon="Play"
                Style="{ThemeResource AppBarButtonRevealStyle}" />

            <AppBarButton
                x:Uid="MainNavView_CommandBar_AppBarButton_Pause"
                Command="{Binding BPauseCommand}"
                Icon="Pause"
                Style="{ThemeResource AppBarButtonRevealStyle}" />

            <AppBarButton
                x:Uid="MainNavView_CommandBar_AppBarButton_Stop"
                Command="{Binding BStopCommand}"
                Icon="Stop"
                Style="{ThemeResource AppBarButtonRevealStyle}" />
        </CommandBar>

        <ListView
            Grid.Row="1"
            ItemsSource="{Binding TorrentsCollection}"
            SelectedItem="{Binding SelectedTorrent, Mode=TwoWay}">

            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.ItemTemplate>
                <DataTemplate>
                    <StackPanel ContextFlyout="{StaticResource ListViewItemFlyout}">
                        <TextBlock
                            Margin="5"
                            FontSize="16"
                            Text="{Binding Name}" />

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <TextBlock Margin="5">
                                    <Run Text="{Binding DownloadedSize}" />
                                    <Run Text=" of " />
                                    <Run Text="{Binding TotalSize}" />
                                    <Run Text=" · " />
                                    <Run Text="{Binding Progress, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}{0:F2} %'}" />
                                </TextBlock>

                                <SymbolIcon Margin="5" Symbol="Download" />
                                <TextBlock Margin="5" Text="{Binding DownloadSpeed, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}{0}/s'}" />

                                <SymbolIcon Margin="5" Symbol="Upload" />
                                <TextBlock Margin="5" Text="{Binding UploadSpeed, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}{0}/s'}" />
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <SymbolIcon Margin="5" Symbol="List" />
                                <TextBlock Margin="5" Text="{Binding State}" />
                            </StackPanel>
                        </Grid>

                        <ProgressBar
                            Margin="5"
                            ContextFlyout="{StaticResource ListViewItemFlyout}"
                            Value="{Binding Progress}" />
                    </StackPanel>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <controls:GridSplitter
            Grid.Row="2"
            Background="{ThemeResource SystemControlAcrylicElementBrush}"
            Foreground="{ThemeResource SystemControlAcrylicWindowBrush}" />

        <Pivot Grid.Row="3" Background="{ThemeResource SystemControlAcrylicElementBrush}">
            <Pivot.Items>
                <PivotItem Header="Информация">
                    <StackPanel>
                        <ProgressBar
                            Height="23"
                            Margin="0,5,0,5"
                            Value="{Binding SelectedTorrent.Progress}" />

                        <controls:Expander
                            Margin="0,5,0,0"
                            HorizontalContentAlignment="Stretch"
                            Header="Торрент"
                            IsExpanded="True">

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <StackPanel
                                    Grid.Column="0"
                                    Margin="5"
                                    VerticalAlignment="Center">
                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Активен: " />
                                        <TextBlock Text="{Binding MainPivotModel.ActiveTime}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Загружено: " />
                                        <TextBlock Text="{Binding MainPivotModel.DownloadSize}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Загрузка: " />
                                        <TextBlock Text="{Binding MainPivotModel.DownloadSpeed, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}{0}/s'}" />
                                    </controls:UniformGrid>
                                </StackPanel>

                                <StackPanel
                                    Grid.Column="1"
                                    Margin="5"
                                    VerticalAlignment="Center">
                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Активен: " />
                                        <TextBlock Text="{Binding MainPivotModel.LeftTime}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Отдано: " />
                                        <TextBlock Text="{Binding MainPivotModel.UploadSize}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Отдача: " />
                                        <TextBlock Text="{Binding MainPivotModel.UploadSpeed, Converter={StaticResource StringFormatConverter}, ConverterParameter='{}{0}/s'}" />
                                    </controls:UniformGrid>
                                </StackPanel>

                                <StackPanel
                                    Grid.Column="2"
                                    Margin="5"
                                    VerticalAlignment="Center">
                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Соединений: " />
                                        <TextBlock Text="{Binding MainPivotModel.ConnectionCount}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Сиды: " />
                                        <TextBlock Text="{Binding MainPivotModel.SeedsCount}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Пиры: " />
                                        <TextBlock Text="{Binding MainPivotModel.PeersCount}" />
                                    </controls:UniformGrid>
                                </StackPanel>
                            </Grid>
                        </controls:Expander>

                        <controls:Expander
                            Margin="0,0,0,5"
                            HorizontalContentAlignment="Stretch"
                            Header="Дополнительно"
                            IsExpanded="True">

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <StackPanel
                                    Grid.Column="0"
                                    Margin="5"
                                    VerticalAlignment="Center">
                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Общий размер: " />
                                        <TextBlock Text="{Binding MainPivotModel.TotalSize}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Дата добавления: " />
                                        <TextBlock Text="{Binding MainPivotModel.DateAdded}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Хеш: " />
                                        <TextBlock Text="{Binding MainPivotModel.Hash}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Путь: " />
                                        <TextBlock Text="{Binding MainPivotModel.SavePath}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Комментарий: " />
                                        <TextBlock Text="{Binding MainPivotModel.Comment}" />
                                    </controls:UniformGrid>
                                </StackPanel>

                                <StackPanel
                                    Grid.Column="1"
                                    Margin="5"
                                    VerticalAlignment="Top">
                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Части: " />
                                        <TextBlock Text="{Binding MainPivotModel.PieceCount}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Дата завершения: " />
                                        <TextBlock Text="{Binding MainPivotModel.DateCompletion}" />
                                    </controls:UniformGrid>
                                </StackPanel>

                                <StackPanel
                                    Grid.Column="2"
                                    Margin="5"
                                    VerticalAlignment="Top">
                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Создан в: " />
                                        <TextBlock Text="{Binding MainPivotModel.CreateIn}" />
                                    </controls:UniformGrid>

                                    <controls:UniformGrid Column="2" Rows="1">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            HorizontalAlignment="Right"
                                            Text="Дата создания: " />
                                        <TextBlock Text="{Binding MainPivotModel.DateCreate}" />
                                    </controls:UniformGrid>
                                </StackPanel>
                            </Grid>
                        </controls:Expander>
                    </StackPanel>
                </PivotItem>

                <PivotItem Header="Файлы">
                    <TreeView ItemsSource="{Binding MainPivotModel.TorrentFiles}">
                        <TreeView.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="5" Orientation="Horizontal">
                                    <SymbolIcon Margin="5" Symbol="OpenFile" />
                                    <TextBlock Margin="5" Text="{Binding FullPath, Converter={StaticResource FullPathToFileNameConverter}}" />
                                    <ProgressBar
                                        Width="100"
                                        Height="23"
                                        Margin="5"
                                        Value="{Binding BitField.PercentComplete}" />
                                </StackPanel>
                            </DataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </PivotItem>
            </Pivot.Items>
        </Pivot>
    </Grid>
</Page>